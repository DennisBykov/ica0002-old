---
  - name: init
    become: yes
    gather_facts: no
    roles:
      - init
    hosts:
      - all

  - name: Database server
    become: yes
    roles:
      - mysql
    hosts:
      - db_servers


  - name: Web server
    hosts: web_servers
    become: yes
    roles:
      - agama
      - uwsgi
      - nginx
      - prometheus

  - name: Install prometheus node exporter on all hosts
    hosts: all
    become: yes
    roles:
      - node_exporter

  - name: Setup
    hosts: all
    become: yes
    gather_facts: yes
    tasks:
      - setup:
  
  - name: DNS server
    hosts: DennisBykov-2
    become: yes
    roles:
      - bind
    tasks:
      - debug:
          msg: "{% for vm in groups['all'] %} nameserver {{ hostvars[vm]['ansible_default_ipv4']['address'] }}{% endfor %}"

  - name: change server name vm
    hosts: all
    become: yes
    gather_facts: no
    roles:
      - dns_resolved
